# Audio Service

The audio service is responsible for loading TTS and Audio plugins

All audio playback is handled by this service

## Dialog Transformers

**NEW** in `ovos-core` version **0.0.8**

Similarly to utterance transformers in core,  `ovos-audio` exposes `utterance` and message.`context` to a set
of plugins that can transform it before TTS stage

The `utterance` to be spoken is sent sequentially to all transformer plugins, ordered by priority (developer defined),
until finally it is sent to the TTS stage

| plugin                                | description                                    | source                                                                                                                    |
|---------------------------------------|------------------------------------------------|---------------------------------------------------------------------------------------------------------------------------|
| ovos-dialog-transformer-openai-plugin | rewrite speech with a LLM before executing TTS | [OpenVoiceOS/ovos-solver-plugin-openai-persona](https://github.com/OpenVoiceOS/ovos-solver-plugin-openai-persona)         |
| ovos-dialog-translation-plugin        | translate speech back into user language       | [OpenVoiceOS/ovos-bidirectional-translation-plugin](https://github.com/OpenVoiceOS/ovos-bidirectional-translation-plugin) |

To enable a transformer add it to `mycroft.conf`

```javascript
// To enable a dialog transformer plugin just add it's name with any relevant config
// these plugins can mutate utterances before TTS
"dialog_transformers": {
    "ovos-dialog-translation-plugin": {},
    "ovos-dialog-transformer-openai-plugin": {
        "rewrite_prompt": "rewrite the text as if you were explaining it to a 5 year old"
    }
}
```


## TTS

Two TTS plugins may be loaded at once, if the primary plugin fails for some reason the second plugin will be used.

This allows you to have a lower quality offline voice as fallback to account for internet outages, this ensures your
device can always give you feedback

```javascript
"tts": {
    "pulse_duck": false,
    
    // plugins to load
    "module": "ovos-tts-plugin-server",
    "fallback_module": "ovos-tts-plugin-mimic",
    
    // individual plugin configs
    "ovos-tts-plugin-server": {
        "host": "https://tts.smartgic.io/piper",
        "v2": true,
        "verify_ssl": true,
        "tts_timeout": 5,
    }
}
```

## TTS Transformers

**NEW** in `ovos-core` version **0.0.8**

Similarly to audio transformers in `ovos-dinkum-listener`, the audio data generated by TTS is exposed to a set
of plugins that can transform it before playback

The audio to be spoken is sent sequentially to all transformer plugins, ordered by priority (developer defined),
until finally it played back to the user

NOTE: Does not work with StreamingTTS

| plugin                          | description                   | source                                                                                                        |
|---------------------------------|-------------------------------|---------------------------------------------------------------------------------------------------------------|
| ovos-tts-transformer-sox-plugin | apply sound effects via `sox` | [OpenVoiceOS/ovos-tts-transformer-sox-plugin](https://github.com/OpenVoiceOS/ovos-tts-transformer-sox-plugin) |

To enable a transformer add it to `mycroft.conf`

```javascript
// To enable a tts transformer plugin just add it's name with any relevant config
// these plugins can mutate utterances before TTS
"tts_transformers": {
    "ovos-tts-transformer-sox-plugin": {
        "default_effects": {
            "speed": {"factor": 1.1}
        }
    }
}
```

## Audio

You can enable additional Audio plugins and define the native sources described above under the `"Audio"` section
of `mycroft.conf`

ovos-core uses OCP natively for media playback, you can learn more about
OCP [here](https://openvoiceos.github.io/community-docs/OCP)

OCP will decide when to call the Audio service and what plugin to use

**DEPRECATION WARNING** -  `ovos-core` version **0.0.8** introduces the option to disable the old audio service, this
will be a default in version **0.1.0** when `ovos-media` is introduced

```javascript
"Audio": {
    "native_sources": ["debug_cli", "audio"],

    "backends": {
      "OCP": {
        "type": "ovos_common_play",
        "active": true
      },
      "simple": {
        "type": "ovos_audio_simple",
        "active": true
      },
      "vlc": {
        "type": "ovos_vlc",
        "active": true
      }
    }
},
```

## Native playback

Usually playback is triggered by some originating bus message, eg `"recognizer_loop:utterance"`, this message contains
metadata that is used to determine if playback should happen.

`message.context` may contain a source and destination, playback is only triggered if a message destination is a
native_source or if missing (considered a broadcast).

This separation of native sources allows remote clients such as an android app to interact with OVOS without the actual
device where ovos-core is running repeating all TTS and music playback out loud

You can learn more about message targeting [here](https://jarbashivemind.github.io/HiveMind-community-docs/mycroft/)

By default, only utterances originating from the speech client and ovos cli are considered native

for legacy reasons the names for ovos cli and speech client are `"debug_cli"` and `"audio"` respectively
